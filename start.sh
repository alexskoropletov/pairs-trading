#!/usr/bin/env bash

echo "üöÄ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º..."
echo "=========================================="

# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
echo "üì¶ –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞..."
npm run build
if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞"
    exit 1
fi
echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–∫—Ü–∏–π
echo "üìä –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–∫—Ü–∏–π..."
node dist/get_s_n_p.js
if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∞–∫—Ü–∏–π"
    exit 1
fi
echo "‚úÖ –°–ø–∏—Å–æ–∫ –∞–∫—Ü–∏–π –ø–æ–ª—É—á–µ–Ω"

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ –≤—Å–µ–º —Ç–∏–∫–µ—Ä–∞–º
echo "üì• –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ –≤—Å–µ–º —Ç–∏–∫–µ—Ä–∞–º..."
echo "üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω..."
node dist/fetch_prices.js
if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö"
    exit 1
fi
echo "‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã"

# –ê–Ω–∞–ª–∏–∑ –ø–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º
echo "üîç –ê–Ω–∞–ª–∏–∑ –ø–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º..."
node dist/index_pairs_analysis.js
if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –ø–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º"
    exit 1
fi
echo "‚úÖ –ê–Ω–∞–ª–∏–∑ –ø–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º –∑–∞–≤–µ—Ä—à–µ–Ω"

# –ê–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ñ–µ–ª—è –ú–∞—Ä–∫–æ–≤–∏—Ü–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞
echo "üìà –ê–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ñ–µ–ª—è –ú–∞—Ä–∫–æ–≤–∏—Ü–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞..."
node dist/index_portfolio_analysis.js
if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º"
    exit 1
fi
echo "‚úÖ –ê–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–π –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º –∑–∞–≤–µ—Ä—à–µ–Ω"

# –û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ñ–µ–ª—è –ú–∞—Ä–∫–æ–≤–∏—Ü–∞
echo "üìà –û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ñ–µ–ª—è –ú–∞—Ä–∫–æ–≤–∏—Ü–∞..."
node dist/markowitz_portfolio.js
if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è"
    exit 1
fi
echo "‚úÖ –ê–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ñ–µ–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫ –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º
echo "üé® –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫ –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º..."

INFOGRAFICS_DIR="infographics"
if [ -d "$INFOGRAFICS_DIR" ]; then
    echo "üìä –ù–∞–π–¥–µ–Ω—ã –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º:"
    ls -la "$INFOGRAFICS_DIR"/*.png 2>/dev/null || echo "   –ò–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
fi

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Telegram
echo "üì± –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Telegram..."
node dist/telegram_sender.js
if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram"
    exit 1
fi
echo "‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Telegram"

echo ""
echo "üéâ –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
echo "=========================================="
echo "üìÅ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤:"
echo "   - stats/sp500/ (–æ—Ç—á–µ—Ç—ã S&P500)"
echo "   - stats/nasdaq/ (–æ—Ç—á–µ—Ç—ã NASDAQ)"
echo "   - stats/imoex/ (–æ—Ç—á–µ—Ç—ã IMOEX)"
echo "   - stats/rucbitr/ (–æ—Ç—á–µ—Ç—ã RUCBITR)"
echo "   - stats/rgbi/ (–æ—Ç—á–µ—Ç—ã RGBI)"
echo "   - infographics/sp500/ (–∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏ S&P500)"
echo "   - infographics/nasdaq/ (–∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏ NASDAQ)"
echo "   - infographics/imoex/ (–∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏ IMOEX)"
echo "   - infographics/rucbitr/ (–∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏ RUCBITR)"
echo "   - infographics/rgbi/ (–∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏ RGBI)"
echo "   - stats/summary.json (—Å–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç)"
echo ""
echo "üìä –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:"
echo "   üá∫üá∏ S&P500 - –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–µ –∞–∫—Ü–∏–∏"
echo "   üìà NASDAQ - —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∞–∫—Ü–∏–∏"
echo "   üá∑üá∫ IMOEX - —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –∞–∫—Ü–∏–∏"
echo "   üè¢ RUCBITR - —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –æ–±–ª–∏–≥–∞—Ü–∏–∏"
echo "   üìà RGBI - —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –æ–±–ª–∏–≥–∞—Ü–∏–∏"
echo ""
echo "‚úÖ –í—Å–µ —ç—Ç–∞–ø—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
